3103 679 823
4605
Model(
  (backbone): CBraMod(
    (patch_embedding): PatchEmbedding(
      (positional_encoding): Sequential(
        (0): Conv2d(200, 200, kernel_size=(19, 7), stride=(1, 1), padding=(9, 3), groups=200)
      )
      (proj_in): Sequential(
        (0): Conv2d(1, 25, kernel_size=(1, 49), stride=(1, 25), padding=(0, 24))
        (1): GroupNorm(5, 25, eps=1e-05, affine=True)
        (2): GELU(approximate='none')
        (3): Conv2d(25, 25, kernel_size=(1, 3), stride=(1, 1), padding=(0, 1))
        (4): GroupNorm(5, 25, eps=1e-05, affine=True)
        (5): GELU(approximate='none')
        (6): Conv2d(25, 25, kernel_size=(1, 3), stride=(1, 1), padding=(0, 1))
        (7): GroupNorm(5, 25, eps=1e-05, affine=True)
        (8): GELU(approximate='none')
      )
      (spectral_proj): Sequential(
        (0): Linear(in_features=101, out_features=200, bias=True)
        (1): Dropout(p=0.1, inplace=False)
      )
    )
    (encoder): TransformerEncoder(
      (layers): ModuleList(
        (0-11): 12 x TransformerEncoderLayer(
          (self_attn_s): MultiheadAttention(
            (out_proj): NonDynamicallyQuantizableLinear(in_features=100, out_features=100, bias=True)
          )
          (self_attn_t): MultiheadAttention(
            (out_proj): NonDynamicallyQuantizableLinear(in_features=100, out_features=100, bias=True)
          )
          (linear1): Linear(in_features=200, out_features=800, bias=True)
          (dropout): Dropout(p=0.1, inplace=False)
          (linear2): Linear(in_features=800, out_features=200, bias=True)
          (norm1): LayerNorm((200,), eps=1e-05, elementwise_affine=True)
          (norm2): LayerNorm((200,), eps=1e-05, elementwise_affine=True)
          (dropout1): Dropout(p=0.1, inplace=False)
          (dropout2): Dropout(p=0.1, inplace=False)
        )
      )
    )
    (proj_out): Identity()
  )
  (classifier): Sequential(
    (0): Rearrange('b c s d -> b (c s d)')
    (1): Linear(in_features=19000, out_features=1000, bias=True)
    (2): ELU(alpha=1.0)
    (3): Dropout(p=0.1, inplace=False)
    (4): Linear(in_features=1000, out_features=200, bias=True)
    (5): ELU(alpha=1.0)
    (6): Dropout(p=0.1, inplace=False)
    (7): Linear(in_features=200, out_features=1, bias=True)
    (8): Rearrange('b 1 -> (b 1)')
  )
)
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.86it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.92it/s]
Epoch 1 : Training Loss: 0.58997, acc: 0.83522, pr_auc: 0.90859, roc_auc: 0.91818, LR: 0.00030, Time elapsed 0.25 mins
[[1481  170]
 [ 329 1123]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 22.19it/s]
val Evaluation: acc: 0.59464, pr_auc: 0.68356, roc_auc: 0.62986
[[174 164]
 [111 230]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.59464, pr_auc: 0.68356, roc_auc: 0.62986
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:09<00:00,  5.20it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 19.75it/s]
Epoch 2 : Training Loss: 0.32499, acc: 0.94335, pr_auc: 0.98216, roc_auc: 0.98466, LR: 0.00029, Time elapsed 0.20 mins
[[1506  145]
 [  37 1415]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.02it/s]
val Evaluation: acc: 0.57085, pr_auc: 0.57827, roc_auc: 0.60857
[[149 189]
 [102 239]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.76it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.32it/s]
Epoch 3 : Training Loss: 0.19505, acc: 0.94104, pr_auc: 0.99048, roc_auc: 0.99156, LR: 0.00028, Time elapsed 0.18 mins
[[1603   48]
 [ 129 1323]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.98it/s]
val Evaluation: acc: 0.59913, pr_auc: 0.61034, roc_auc: 0.57188
[[181 157]
 [115 226]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.74it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.88it/s]
Epoch 4 : Training Loss: 0.10605, acc: 0.98101, pr_auc: 0.99729, roc_auc: 0.99770, LR: 0.00027, Time elapsed 0.18 mins
[[1619   32]
 [  27 1425]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.38it/s]
val Evaluation: acc: 0.51779, pr_auc: 0.64633, roc_auc: 0.60179
[[128 210]
 [117 224]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 19.93it/s]
Epoch 5 : Training Loss: 0.07289, acc: 0.97592, pr_auc: 0.99810, roc_auc: 0.99818, LR: 0.00026, Time elapsed 0.18 mins
[[1642    9]
 [  62 1390]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.07it/s]
val Evaluation: acc: 0.60223, pr_auc: 0.63849, roc_auc: 0.59838
[[194 144]
 [126 215]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.95it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.48it/s]
Epoch 6 : Training Loss: 0.06217, acc: 0.98773, pr_auc: 0.99897, roc_auc: 0.99910, LR: 0.00024, Time elapsed 0.18 mins
[[1623   28]
 [  11 1441]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 21.08it/s]
val Evaluation: acc: 0.55471, pr_auc: 0.77302, roc_auc: 0.67407
[[148 190]
 [112 229]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.55471, pr_auc: 0.77302, roc_auc: 0.67407
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.74it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 19.87it/s]
Epoch 7 : Training Loss: 0.05454, acc: 0.99317, pr_auc: 0.99946, roc_auc: 0.99953, LR: 0.00022, Time elapsed 0.18 mins
[[1633   18]
 [   4 1448]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 21.66it/s]
val Evaluation: acc: 0.54580, pr_auc: 0.59115, roc_auc: 0.62950
[[139 199]
 [109 232]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.83it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.31it/s]
Epoch 8 : Training Loss: 0.03641, acc: 0.99703, pr_auc: 0.99988, roc_auc: 0.99989, LR: 0.00020, Time elapsed 0.18 mins
[[1648    3]
 [   6 1446]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.38it/s]
val Evaluation: acc: 0.53700, pr_auc: 0.55538, roc_auc: 0.56370
[[139 199]
 [115 226]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.70it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.66it/s]
Epoch 9 : Training Loss: 0.03114, acc: 0.98560, pr_auc: 0.99915, roc_auc: 0.99926, LR: 0.00017, Time elapsed 0.18 mins
[[1608   43]
 [   4 1448]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.30it/s]
val Evaluation: acc: 0.55026, pr_auc: 0.64543, roc_auc: 0.61959
[[144 194]
 [111 230]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.28it/s]
Epoch 10 : Training Loss: 0.02526, acc: 0.99625, pr_auc: 0.99999, roc_auc: 0.99999, LR: 0.00015, Time elapsed 0.18 mins
[[1650    1]
 [  10 1442]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.05it/s]
val Evaluation: acc: 0.57402, pr_auc: 0.70736, roc_auc: 0.61149
[[167 171]
 [118 223]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.26it/s]
Epoch 11 : Training Loss: 0.00597, acc: 0.99862, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00013, Time elapsed 0.18 mins
[[1651    0]
 [   4 1448]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.45it/s]
val Evaluation: acc: 0.56957, pr_auc: 0.62467, roc_auc: 0.60525
[[163 175]
 [117 224]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 19.92it/s]
Epoch 12 : Training Loss: 0.00888, acc: 0.99905, pr_auc: 0.99999, roc_auc: 0.99999, LR: 0.00010, Time elapsed 0.18 mins
[[1649    2]
 [   1 1451]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 22.79it/s]
val Evaluation: acc: 0.54307, pr_auc: 0.56072, roc_auc: 0.55941
[[155 183]
 [127 214]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.77it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.88it/s]
Epoch 13 : Training Loss: 0.00373, acc: 0.99970, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00008, Time elapsed 0.18 mins
[[1650    1]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.33it/s]
val Evaluation: acc: 0.54288, pr_auc: 0.73541, roc_auc: 0.64079
[[140 198]
 [112 229]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.79it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.36it/s]
Epoch 14 : Training Loss: 0.00228, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00006, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 22.97it/s]
val Evaluation: acc: 0.55919, pr_auc: 0.63389, roc_auc: 0.56756
[[154 184]
 [115 226]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.70it/s]
Epoch 15 : Training Loss: 0.00092, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00004, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 21.26it/s]
val Evaluation: acc: 0.54735, pr_auc: 0.69695, roc_auc: 0.61961
[[146 192]
 [115 226]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.78it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.77it/s]
Epoch 16 : Training Loss: 0.00061, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00003, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 20.23it/s]
val Evaluation: acc: 0.53996, pr_auc: 0.69101, roc_auc: 0.60214
[[141 197]
 [115 226]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.80it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.68it/s]
Epoch 17 : Training Loss: 0.00069, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00002, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.16it/s]
val Evaluation: acc: 0.53850, pr_auc: 0.63881, roc_auc: 0.55607
[[142 196]
 [117 224]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.75it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 21.44it/s]
Epoch 18 : Training Loss: 0.00053, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00001, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 19.84it/s]
val Evaluation: acc: 0.53701, pr_auc: 0.66089, roc_auc: 0.57520
[[140 198]
 [116 225]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.99it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 19.59it/s]
Epoch 19 : Training Loss: 0.00030, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00000, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 23.05it/s]
val Evaluation: acc: 0.54145, pr_auc: 0.65551, roc_auc: 0.57327
[[143 195]
 [116 225]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:08<00:00,  5.78it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 20.94it/s]
Epoch 20 : Training Loss: 0.00015, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00000, Time elapsed 0.18 mins
[[1651    0]
 [   0 1452]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 19.91it/s]
val Evaluation: acc: 0.54145, pr_auc: 0.65533, roc_auc: 0.57292
[[143 195]
 [116 225]]
***************************Test************************
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 13/13 [00:00<00:00, 19.34it/s]
***************************Test results************************
Test Evaluation: acc: 0.43674, pr_auc: 0.43632, roc_auc: 0.50545
[[244 210]
 [245 124]]
model save in ./data/wjq/models_weights/Big/BigFaced/epoch20_acc_0.43674_pr_0.43632_roc_0.50545.pth
5-fold cross validation results: acc 0.08734882943543092, pr_auc 0.08726324309763926, roc_auc 0.10108938314052744
Done!!!!!
