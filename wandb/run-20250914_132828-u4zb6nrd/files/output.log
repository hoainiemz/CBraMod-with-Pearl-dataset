3103 679 823
4605
Model(
  (backbone): CBraMod(
    (patch_embedding): PatchEmbedding(
      (positional_encoding): Sequential(
        (0): Conv2d(200, 200, kernel_size=(19, 7), stride=(1, 1), padding=(9, 3), groups=200)
      )
      (proj_in): Sequential(
        (0): Conv2d(1, 25, kernel_size=(1, 49), stride=(1, 25), padding=(0, 24))
        (1): GroupNorm(5, 25, eps=1e-05, affine=True)
        (2): GELU(approximate='none')
        (3): Conv2d(25, 25, kernel_size=(1, 3), stride=(1, 1), padding=(0, 1))
        (4): GroupNorm(5, 25, eps=1e-05, affine=True)
        (5): GELU(approximate='none')
        (6): Conv2d(25, 25, kernel_size=(1, 3), stride=(1, 1), padding=(0, 1))
        (7): GroupNorm(5, 25, eps=1e-05, affine=True)
        (8): GELU(approximate='none')
      )
      (spectral_proj): Sequential(
        (0): Linear(in_features=101, out_features=200, bias=True)
        (1): Dropout(p=0.1, inplace=False)
      )
    )
    (encoder): TransformerEncoder(
      (layers): ModuleList(
        (0-11): 12 x TransformerEncoderLayer(
          (self_attn_s): MultiheadAttention(
            (out_proj): NonDynamicallyQuantizableLinear(in_features=100, out_features=100, bias=True)
          )
          (self_attn_t): MultiheadAttention(
            (out_proj): NonDynamicallyQuantizableLinear(in_features=100, out_features=100, bias=True)
          )
          (linear1): Linear(in_features=200, out_features=800, bias=True)
          (dropout): Dropout(p=0.1, inplace=False)
          (linear2): Linear(in_features=800, out_features=200, bias=True)
          (norm1): LayerNorm((200,), eps=1e-05, elementwise_affine=True)
          (norm2): LayerNorm((200,), eps=1e-05, elementwise_affine=True)
          (dropout1): Dropout(p=0.1, inplace=False)
          (dropout2): Dropout(p=0.1, inplace=False)
        )
      )
    )
    (proj_out): Identity()
  )
  (meta_backbone): Sequential(
    (0): Linear(in_features=28, out_features=50, bias=True)
    (1): ELU(alpha=1.0)
    (2): Dropout(p=0.1, inplace=False)
    (3): Linear(in_features=50, out_features=100, bias=True)
    (4): ELU(alpha=1.0)
    (5): Dropout(p=0.1, inplace=False)
  )
  (classifier): Sequential(
    (0): Rearrange('b c s d -> b (c s d)')
    (1): Linear(in_features=19000, out_features=1000, bias=True)
    (2): ELU(alpha=1.0)
    (3): Dropout(p=0.1, inplace=False)
    (4): Linear(in_features=1000, out_features=100, bias=True)
    (5): ELU(alpha=1.0)
    (6): Dropout(p=0.1, inplace=False)
  )
  (final_classifier): Sequential(
    (0): Linear(in_features=100, out_features=100, bias=True)
    (1): ELU(alpha=1.0)
    (2): Dropout(p=0.1, inplace=False)
    (3): Linear(in_features=100, out_features=1, bias=True)
    (4): Rearrange('b 1 -> (b 1)')
  )
)
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:16<00:00,  2.94it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.33it/s]
Epoch 1 : Training Loss: 0.55647, acc: 0.85417, pr_auc: 0.91534, roc_auc: 0.92796, LR: 0.00030, Time elapsed 0.34 mins
[[1514  137]
 [ 303 1149]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 13.29it/s]
val Evaluation: acc: 0.68464, pr_auc: 0.77669, roc_auc: 0.75698
[[217 121]
 [ 93 248]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.68464, pr_auc: 0.77669, roc_auc: 0.75698
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.96it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.76it/s]
Epoch 2 : Training Loss: 0.32247, acc: 0.90152, pr_auc: 0.97737, roc_auc: 0.98080, LR: 0.00029, Time elapsed 0.27 mins
[[1601   50]
 [ 242 1210]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 13.59it/s]
val Evaluation: acc: 0.76090, pr_auc: 0.82081, roc_auc: 0.82362
[[218 120]
 [ 42 299]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.76090, pr_auc: 0.82081, roc_auc: 0.82362
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.93it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.49it/s]
Epoch 3 : Training Loss: 0.18773, acc: 0.96213, pr_auc: 0.99155, roc_auc: 0.99275, LR: 0.00028, Time elapsed 0.27 mins
[[1576   75]
 [  44 1408]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.16it/s]
val Evaluation: acc: 0.71687, pr_auc: 0.77043, roc_auc: 0.79134
[[215 123]
 [ 69 272]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.92it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.81it/s]
Epoch 4 : Training Loss: 0.14925, acc: 0.98827, pr_auc: 0.99795, roc_auc: 0.99840, LR: 0.00027, Time elapsed 0.27 mins
[[1635   16]
 [  20 1432]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.00it/s]
val Evaluation: acc: 0.77109, pr_auc: 0.83930, roc_auc: 0.85663
[[212 126]
 [ 29 312]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.77109, pr_auc: 0.83930, roc_auc: 0.85663
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.26it/s]
Epoch 5 : Training Loss: 0.07506, acc: 0.98926, pr_auc: 0.99904, roc_auc: 0.99922, LR: 0.00026, Time elapsed 0.27 mins
[[1636   15]
 [  18 1434]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.01it/s]
val Evaluation: acc: 0.82123, pr_auc: 0.88266, roc_auc: 0.89430
[[234 104]
 [ 17 324]]
roc_auc increasing....saving weights !!
Val Evaluation: acc: 0.82123, pr_auc: 0.88266, roc_auc: 0.89430
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.90it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.66it/s]
Epoch 6 : Training Loss: 0.09036, acc: 0.98681, pr_auc: 0.99883, roc_auc: 0.99893, LR: 0.00024, Time elapsed 0.27 mins
[[1637   14]
 [  26 1426]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.44it/s]
val Evaluation: acc: 0.72458, pr_auc: 0.75670, roc_auc: 0.80010
[[244  94]
 [ 93 248]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.78it/s]
Epoch 7 : Training Loss: 0.04910, acc: 0.98768, pr_auc: 0.99932, roc_auc: 0.99943, LR: 0.00022, Time elapsed 0.27 mins
[[1616   35]
 [   5 1447]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.30it/s]
val Evaluation: acc: 0.64215, pr_auc: 0.58092, roc_auc: 0.63728
[[107 231]
 [ 11 330]]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.92it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.82it/s]
Epoch 8 : Training Loss: 0.03865, acc: 0.99535, pr_auc: 0.99991, roc_auc: 0.99992, LR: 0.00020, Time elapsed 0.27 mins
[[1647    4]
 [  10 1442]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 15.00it/s]
val Evaluation: acc: 0.65769, pr_auc: 0.56945, roc_auc: 0.65842
[[174 164]
 [ 68 273]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.04it/s]
Epoch 9 : Training Loss: 0.01802, acc: 0.99832, pr_auc: 0.99998, roc_auc: 0.99998, LR: 0.00017, Time elapsed 0.27 mins
[[1650    1]
 [   4 1448]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.67it/s]
val Evaluation: acc: 0.73875, pr_auc: 0.75509, roc_auc: 0.79596
[[206 132]
 [ 45 296]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.15it/s]
Epoch 10 : Training Loss: 0.01288, acc: 0.99905, pr_auc: 0.99998, roc_auc: 0.99998, LR: 0.00015, Time elapsed 0.27 mins
[[1649    2]
 [   1 1451]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.24it/s]
val Evaluation: acc: 0.72401, pr_auc: 0.73310, roc_auc: 0.76747
[[200 138]
 [ 49 292]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.88it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.77it/s]
Epoch 11 : Training Loss: 0.01495, acc: 0.99939, pr_auc: 0.99999, roc_auc: 0.99999, LR: 0.00013, Time elapsed 0.27 mins
[[1649    2]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.91it/s]
val Evaluation: acc: 0.72378, pr_auc: 0.73614, roc_auc: 0.76262
[[182 156]
 [ 31 310]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.86it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.14it/s]
Epoch 12 : Training Loss: 0.00914, acc: 0.99905, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00010, Time elapsed 0.27 mins
[[1649    2]
 [   1 1451]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.43it/s]
val Evaluation: acc: 0.76962, pr_auc: 0.73280, roc_auc: 0.80980
[[212 126]
 [ 30 311]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.94it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.64it/s]
Epoch 13 : Training Loss: 0.00207, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00008, Time elapsed 0.27 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.94it/s]
val Evaluation: acc: 0.75209, pr_auc: 0.77365, roc_auc: 0.82212
[[217 121]
 [ 47 294]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:09<00:00,  5.02it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:02<00:00, 17.24it/s]
Epoch 14 : Training Loss: 0.00342, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00006, Time elapsed 0.21 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.12it/s]
val Evaluation: acc: 0.74576, pr_auc: 0.75477, roc_auc: 0.81072
[[181 157]
 [ 15 326]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  4.07it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.66it/s]
Epoch 15 : Training Loss: 0.00479, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00004, Time elapsed 0.26 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 13.64it/s]
val Evaluation: acc: 0.72934, pr_auc: 0.70020, roc_auc: 0.79408
[[159 179]
 [  4 337]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.02it/s]
Epoch 16 : Training Loss: 0.00138, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00003, Time elapsed 0.27 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.40it/s]
val Evaluation: acc: 0.76647, pr_auc: 0.76017, roc_auc: 0.81905
[[195 143]
 [ 15 326]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.87it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.56it/s]
Epoch 17 : Training Loss: 0.00028, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00002, Time elapsed 0.27 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 13.59it/s]
val Evaluation: acc: 0.74875, pr_auc: 0.74627, roc_auc: 0.80389
[[186 152]
 [ 18 323]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.89it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.99it/s]
Epoch 18 : Training Loss: 0.00043, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00001, Time elapsed 0.27 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.40it/s]
val Evaluation: acc: 0.75614, pr_auc: 0.75578, roc_auc: 0.81067
[[190 148]
 [ 17 324]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.93it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 14.67it/s]
Epoch 19 : Training Loss: 0.00053, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00000, Time elapsed 0.26 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 13.88it/s]
val Evaluation: acc: 0.75317, pr_auc: 0.75484, roc_auc: 0.80952
[[187 151]
 [ 16 325]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:12<00:00,  3.87it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:03<00:00, 13.99it/s]
Epoch 20 : Training Loss: 0.00064, acc: 1.00000, pr_auc: 1.00000, roc_auc: 1.00000, LR: 0.00000, Time elapsed 0.27 mins
[[1651    0]
 [   0 1452]]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:00<00:00, 14.60it/s]
val Evaluation: acc: 0.75169, pr_auc: 0.75308, roc_auc: 0.80893
[[186 152]
 [ 16 325]]
***************************Test************************
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 13/13 [00:01<00:00, 12.08it/s]
***************************Test results************************
Test Evaluation: acc: 0.58539, pr_auc: 0.47514, roc_auc: 0.62306
[[283 171]
 [167 202]]
model save in ./data/wjq/models_weights/Big/BigFaced/epoch20_acc_0.58539_pr_0.47514_roc_0.62306.pth
